# Environment-specific tfvars for 20-workload (dev)

subscription_id = "00000000-0000-0000-0000-000000000000"
tenant_id       = "11111111-1111-1111-1111-111111111111"

environment_code = "dev"
location         = "eastus"
cosmos_location  = "" # optional override; defaults to location
workload_name    = "azreader"
identifier       = ""

# Container image + registry (defaults for local dev)
container_image       = "<acr>.azurecr.io/az-reader:latest"
registry_id           = "" # optional; set to ACR resource ID to grant AcrPull
registry_login_server = "<acr>.azurecr.io"
registry_username     = "" # optional if using managed identity
registry_password     = "" # optional if using managed identity

# Key Vault
key_vault_name                       = "kv-apisix-prod-eus-kv-ww"
key_vault_resource_group             = "rg-apisix-prod-eus-platform"
create_key_vault                     = false
key_vault_sku                        = "standard"
key_vault_soft_delete_retention_days = 7
key_vault_purge_protection_enabled   = true
key_vault_ip_rules                   = ["108.41.164.49/32"]
self_host_tokens_secret_name         = "self-host-tokens"

# App runtime + scaling
target_port           = 8080
cpu                   = 0.5
memory                = "1Gi"
min_replicas          = 1
max_replicas          = 3
ingress_external      = true
ingress_allowed_cidrs = [] # optional CIDR allowlist; empty means open

# Observability
log_retention_days         = 30
log_analytics_workspace_id = ""

# Application settings (non-secret)
app_settings = {
  # Helpful dev defaults; copy to terraform.tfvars.dev and adjust.
  NODE_ENV                          = "production"
  NODE_OPTIONS                      = "--require=/app/build/shared/register-searcher.js"
  AZURE_OPENAI_ENDPOINT             = "https://your-openai-endpoint.openai.azure.com/"
  AZURE_OPENAI_DEPLOYMENT           = "gpt-5-mini"
  AZURE_OPENAI_API_VERSION          = "2024-12-01-preview"
  AZURE_OPENAI_EMBEDDING_DEPLOYMENT = "text-embedding-3-small"
  BLOB_ENABLED                      = "false"
  COSMOS_AUTH_MODE                  = "aad"
  PORT                              = "8080"
  SELF_HOST_TOKENS_SECRET_NAME      = "self-host-tokens"
  SELF_HOST_TOKENS_VAULT_URL        = "https://kv-apisix-prod-eus-kv-ww.vault.azure.net"
}

# Secrets (Key Vault seed values) â€” populated by deploy-workload; keep out of VCS
secrets = {
  azure-openai-api-key  = "<value>"
  brave-search-api-key  = "<value>"
  jina-serp-api-key     = "<value>"
  serper-search-api-key = "<value>"
}

# Map env var -> secret name override (optional)
secret_environment_overrides = {
  AZURE_OPENAI_API_KEY  = "azure-openai-api-key"
  BRAVE_SEARCH_API_KEY  = "brave-search-api-key"
  JINA_SERP_API_KEY     = "jina-serp-api-key"
  SERPER_SEARCH_API_KEY = "serper-search-api-key"
}

# Remote state backend for this stack (populated by deploy_workload.py)
state_resource_group_name  = ""
state_storage_account_name = ""
state_container_name       = "tfstate"
state_blob_key             = "dev/terraform.tfstate"

tags = {
  owner       = "platform-team"
  environment = "dev"
  workload    = "azreader"
}
